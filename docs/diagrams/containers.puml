@startuml Containers
!includeurl https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml
LAYOUT_WITH_LEGEND()
HIDE_STEREOTYPE()

Person(user, "External Viewer", "Any browser user")

System_Boundary(cloud, "Streamlit Community Cloud") {
    Container(streamlitApp, "Streamlit Dashboard", "Python + Streamlit", "Renders KPI cards, charts, and tables; caches proxy responses")
}

System_Boundary(public, "Public Layer") {
    Container(apiProxy, "API Proxy", "Python + FastAPI", "Parametrized aggregation endpoints returning JSON/Arrow/Parquet")
    Container(tunnelSvc, "Tunnel Connector", "Tailscale / reverse SSH", "Maintains outbound-only connectivity into the home cluster")
}

System_Boundary(cluster, "Home Kubernetes Cluster") {
    Container(airflow, "Airflow", "Apache Airflow", "Triggers synthetic data generation and orchestrates dbt runs")
    Container(dataGen, "Synthetic Data Generators", "Python jobs", "Produce orders, clients, items, deliveries, etc.")
    Container(minio, "MinIO", "Object Storage", "Holds bronze/raw JSON & Parquet batches")
    Container(duckdb, "DuckDB + dbt", "DuckDB + dbt", "Executes silver transformations and business logic models")
    Container(sqlserver, "SQL Server", "MS SQL Server", "Stores gold-layer datamarts exposed via views/SPs")
    Container(metrics, "Metrics + Future Logging", "metrics-server / Loki+Promtail (planned)", "Resource metrics and aggregated logs for troubleshooting")
}

Rel(user, streamlitApp, "Explores analytics", "HTTPS")
Rel(streamlitApp, apiProxy, "Fetches filtered datasets", "HTTPS requests")
Rel(apiProxy, tunnelSvc, "Routes read-only queries", "Encrypted channel")
Rel(tunnelSvc, sqlserver, "Executes parametrized SQL", "TDS over tunnel")
Rel(dataGen, minio, "Stores bronze batches")
Rel(airflow, dataGen, "Schedules synthetic workloads")
Rel(airflow, duckdb, "Triggers dbt models")
Rel(duckdb, sqlserver, "Publishes curated tables")
Rel(minio, duckdb, "Feeds bronze -> silver transformations")
Rel(metrics, airflow, "Collects runtime metrics")
Rel(metrics, sqlserver, "Monitors resource usage")

SHOW_LEGEND()
@enduml
