@startuml Context
!includeurl https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml
LAYOUT_WITH_LEGEND()
HIDE_STEREOTYPE()

Person(dev, "Developer", "Operates infrastructure and services")

System_Ext(git, "Source Control + CI", "Git repository and container registry")
System_Ext(keyvault, "Azure Key Vault", "KMS for SOPS encryption keys")

System_Boundary(home, "Home Lab") {
    System(kvm, "KVM/libvirt Host", "Ubuntu host running libvirt and VM storage")
    System(homek8s, "Internal Kubernetes Cluster", "kubeadm control plane + workers for internal workloads")
}

System_Boundary(cloud, "Public Cloud (planned)") {
    System(apik8s, "Public Kubernetes Cluster", "Single-node control plane for API workloads")
}

Rel(dev, git, "Pushes IaC and images", "Git/CI")
Rel(dev, kvm, "Runs Terraform and manages VMs", "SSH")
Rel(dev, homek8s, "Applies Helmfile releases", "kubectl/Helmfile")
Rel(dev, keyvault, "Manages keys and access", "Azure")
Rel(homek8s, keyvault, "Decrypts secrets via SOPS", "KMS")
Rel(homek8s, git, "Pulls container images", "Registry")
Rel(apik8s, git, "Pulls container images", "Registry")

SHOW_LEGEND()
@enduml
